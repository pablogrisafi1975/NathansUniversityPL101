<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
		<meta name="description" content="Try Scheem fake programming language here right now." />
		<meta name="keywords" content="Scheem online edit run code try test" />
		<link rel="stylesheet" href="base.css" type="text/css" media="screen, projection" />
		<link rel="stylesheet" href="jqModal.css" type="text/css" media="screen, projection" />
		<link rel="stylesheet" href="tryscheem.css" type="text/css" media="screen, projection" />
		<title>tryScheem</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
		<script src="parser.js"></script>
		<script src="interpreter.js"></script>
		<script src="jqModal.js"></script>
	</head>
<body>
	<h1>tryScheem</h1>
	<span id = "showIntro" class="menu" >Intro</span><span id = "showHelp" class="menu" >Help</span><span id = "showExamples" class="menu" >Examples</span>
	<table id="main">		
		<div id="intro" class="jqmWindow">		
			<div class="jqmWindowTitle">
				Intro <a href="#" class="jqmClose">Close</a>
			</div>
			<div class="jqmWindowScroll">
				Scheem is a dialect of lisp, or better a crippled-scheme-like language I'm developing thanks to the excellent <a href="http://nathansuniversity.com">http://nathansuniversity.com/ </a><br/>
				Currently only a very limited subset of scheme is supported.<br/>
				As an example, in the 'env' input text write <br/>
				<br/>
				<input class = "exampleEnv" value="a:3, b:[1,2,3]" readonly = "readonly"><br/>
				<br/>
				and in 'code' textarea write<br/>
				<br/>
				<textarea class="exampleCode" readonly="readonly">(if (= a 2)        ;;if a == 2
  (begin           ;;  then
    (set! a 99)    ;;    assign 99 to a
    (cons a b)     ;;    make a list starting with a, ending with b
  )
  (begin           ;;  else
    (define x 99)  ;;    create a variable x = 99
    (+             ;;    sum
      car b)       ;;       first element of b
      x            ;;       to x
    )
  )
)</textarea><br/>
				<br/>
				press F9 and see what happens!<br/>
				See the list of iomplekented functions in "Help" menu.<br/>
				See more examples clicking the "Examples" menu<br/>
			</div>
			
		</div>
		<div id="help" class="jqmWindow">		
			<div class="jqmWindowTitle">
				Help <a href="#" class="jqmClose">Close</a>
			</div>
			<div class="jqmWindowScroll">
				Currently only a very limited subset of scheme is supported.<br/>
				<ul>					
					<li>comments, starting with ;; to the end of the line</li>
					<li>true and false are #t and #t</li>
					<li>basic arithmethic operations : +, - * /  but only two elements at a time</li>
					<li>equality ( =  one_thing another_thing) and less-than ( <  one_number another_number) comparators</li>
					<li>quote a list like '(1 2 3 4) so it is not executed as a function call</li>
					<li>basic list operations: cons, cdr, car, append (only qorks with two lists)</li>
					<li>(isEmpty? list) returns #t if the list is emtpy (doh!)</li>
					<li>(isList? x) returns #t if the X is a list (doh!)</li>
					<li>(length list) returns the lenght of the list (doh!)</li>
					<li>(define variable_name variable_value) creates a new variables</li>
					<li>(set! variable_name variable_value) reassigns an existing variable</li>
					<li>(begin list) executes everything on the list and returns the last value</li>
					<li>(alert something) shows a popup, so please don't use it</li>
					<li>(log something) shows a textual representation in the log window</li>
					<li>(lambda-one variable (function)) returns a function with just one variable</li>
					<li>(lambda (variable_list) (function)) returns a function with many variables</li>					
				</ul>
				<br/>
				Most functions validate the type and number of arguments.<br/>
				Define does not give you any shortcut to avoid calling lambda if you want to create a function.<br/>
				The return of your program is always logged.<br/>
			</div>
		</div>		
		<div id="examples" class="jqmWindow">
			<div class="jqmWindowTitle">
				Examples <a href="#" class="jqmClose">Close</a>
			</div>
			<div class="jqmWindowScroll">
				<h4>Factorial</h4>
				<textarea class="exampleCode" readonly="readonly">;;Factorial:
(begin (define fact (lambda (n) (
  if (= 0 n) 1 
   (*
      n 
     (fact 
	(-  
	   n 
           1))))))
				
  (log (fact 0))
  (log (fact 1))
  (log (fact 4))
  'finished
)</textarea><br/>
				<h4>Fibonacci</h4>
				<textarea class="exampleCode" readonly="readonly">;;Fibonacci:
(begin 
  (define 
    fib 
    (lambda (n)
      (if (< n 2) 
         n 
        (+ 
          (fib (- n 1)) 
          (fib (- n 2))
        )
      )    
    )			
  ) 
  (log (fib 0))
  (log (fib 1))
  (log (fib 2))
  (log (fib 3))
  (log (fib 8))
  'finished
)</textarea><br/>
	<h4>Reverse</h4>
				<textarea class="exampleCode" readonly="readonly">;;Reverse:
(begin
  (define 
    reverse 
     (lambda 
      (x)
      (if (isEmpty? x) 
        '()
	 (append
          (reverse (cdr x)) 
          (cons (car x) '())
         )
       )
     )
   )

  (log (reverse '(1 2 3)))
  (log (reverse '(1)))
  (log	(reverse '()))
  'finished
)</textarea><br/>
<h4>isPresent?</h4>
				<textarea class="exampleCode" readonly="readonly">;;isPresent?:
(begin
  (define 
    isPresent?
     (lambda 
      (x list)
      (if (isEmpty? list) 
        #f
	 (if (= x (car list))
           #t
           (isPresent? x (cdr list))
         )        
       )
     )
   )

  (log (isPresent? 3 '()))
  (log (isPresent? 2 '(1 2 3)))
  (log (isPresent? 4 '(1 2 3)))
  'finished
)</textarea><br/>
<h4>apply</h4>
				<textarea class="exampleCode" readonly="readonly">;;apply
(begin
  (define 
    apply
     (lambda 
      (f list)
      (if (isEmpty? list) 
        '()
        (cons (f (car list)) (apply f (cdr list)))
       )
     )
   )
  (define 
    plusOne
    (lambda 
      (n)
      (+ n 1)
    )
  )
  (log (apply plusOne '()))
  (log (apply plusOne '(1 2 3)))
  'finished
)</textarea><br/>
<h4>flatten</h4>
				<textarea class="exampleCode" readonly="readonly">;;flatten
(begin
  (define 
    flatten
     (lambda 
      (list)
      (if (isEmpty? list) 
        '()
        (if (isList? (car list))
          (append 
            (flatten (car list)) 
            (flatten (cdr list))
          )
          (cons 
            (car list) 
            (flatten (cdr list))
          )
        )        
      )
    )
  )

  (log (flatten '()))
  (log (flatten '(1 2 3)))
  (log (flatten '((101 102 103) 2 3)))
  (log (flatten '((1 2 3) 4 (5 6 (7 8 (9 10))))))
  'finished
)</textarea><br/><br/>
			</div>			
		</div>				
		<thead>
			<tr>
				<th>code <span class="spanenv"> env = {<input type = "text" id = "env"></input> }  (write something like a : 30, b : 60, c :[1 ,2 , 3 ])</span></th>
				<th>log</th>				
			</tr>
		</thead>

		<tbody>
			<tr class="rowbig">
				<td id="cellcode"><textarea id="code" cols="3" rows="3"></textarea></td>
				<td><textarea readonly="readonly" id="log" cols="3" rows="3"></textarea></td>				
			</tr>
			<tr class="rowsmall">
				<td><input type="button" id="focus" value="Focus F8"
					onclick="$('#code').focus()" /> <input type="button" id="runCode"
					value="Run code F9" /> <input type="button" id="clearCode"
					value="Clear code Alt-Ctrl-C" onclick="$('#code').val('')" /></td>
				<td><input type="button" id="clearLog"
					value="Clear log Alt-Ctrl-L" onclick="$('#log').val('')" /></td>					
			</tr>
		</tbody>
	</table>

	<script>
		function toStr(msg) {
			if(typeof msg === 'undefined'){
				return '<undefined>';
			}else if (msg == null){
				return '<null>';
			}
			return msg.toString();
		}

		function log(msg) {
			var textAreaLog = $('#log');
			var strMsg = toStr(msg);
			textAreaLog.val(textAreaLog.val() + strMsg.toString() + '\n');
			textAreaLog = textAreaLog[0]; // the real element, not the jQuery wrapper
			textAreaLog.scrollTop = textAreaLog.scrollHeight;
		};
		function logJSON(obj) {
			log($.toJSON(obj));
		};
		function evalScheemString(code, env){
			var ast = SCHEEM.parse(code);
			return evalScheem(ast, env);
		}		
		$(document).ready(function(){
					$('#runCode').click(function(event) {
						var envOk = true;
						var env = $('#env').val();
						try{
							env = eval("({" + env + "})");
							env = Interpreter.createBasicEnv(env);
						}catch (error) {
							log("Error in env.\n" + error);
							envOk = false;
						}
						if(envOk){
						var code = $('#code').val();
							try {
								log(Interpreter.evalScheemString(code, env));
							} catch (error) {
								log("Error in code.\n" + error);
							}
						}
					});
					$('body').keyup(
							function(event) {
								if (event.altKey && event.ctrlKey) {
									if (event.which == 76) { //L
										$('#clearLog').click();
									} else if (event.which == 67) {//C
										$('#clearCode').click();
									} 
								} else if (!event.altKey && !event.ctrlKey){
									if(event.which == 119) {//F8
										$('#focus').click();
									}
									else if(event.which == 120) {//F9
										$('#runCode').click();
									}
								}
							});
					$('#code').focus(function() {
						$(this).css('background-color', '#e0f0e0');
					}).blur(function() {
						$(this).css('background-color', 'white');
					}).focus();
					$('#env').focus(function() {
						$(this).css('background-color', '#e0f0e0');
					}).blur(function() {
						$(this).css('background-color', 'white');
					});		
					$('#help').jqm({modal: true, trigger: '#showHelp'})
					$('#examples').jqm({modal: true, trigger: '#showExamples'})
					$('#intro').jqm({modal: true, trigger: '#showIntro'})
				});
	</script>
</body>
</html>