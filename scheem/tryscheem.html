<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
		<meta name="description" content="Try Scheem fake programming language here right now." />
		<meta name="keywords" content="Scheem online edit run code try test" />
		<link rel="stylesheet" href="base.css" type="text/css" media="screen, projection" />
		<link rel="stylesheet" href="jqModal.css" type="text/css" media="screen, projection" />
		<link rel="stylesheet" href="tryscheem.css" type="text/css" media="screen, projection" />
		<title>tryScheem</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
		<script src="parser.js"></script>
		<script src="interpreter.js"></script>
		<script src="jqModal.js"></script>
	</head>
<body>
	<h3>tryScheem</h3>
	<span id = "showHelp" class="menu" >Help!</span><span id = "showExamples" class="menu" >Examples!</span>
	<table id="main">		
		<div id="help" class="jqmWindow">		
			<h3>Help</h3>
			<hr/>
			Scheem is a dialect of lisp, or better a crippled-scheme-like language I'm developing thanks to the excellent <a href="http://nathansuniversity.com">http://nathansuniversity.com/ </a><br/>
			Currently only a very strict subset of scheme is supported, there is not even lambda yet!<br/>
			Right now you can use:<br/>
			&nbsp;&nbsp;&nbsp;comments, starting with ;; to the end of the line<br/>
			&nbsp;&nbsp;&nbsp;basic arithmethic ( + - * /) but only two elements at a time<br/>
			&nbsp;&nbsp;&nbsp;equality ( = ) and minor ( < ) comparations) ,two elements at a time<br/>
			&nbsp;&nbsp;&nbsp;quote and if<br/>
			&nbsp;&nbsp;&nbsp;basic list operations: 'cons', 'cdr', 'car'<br/>
			&nbsp;&nbsp;&nbsp;'define' new variables and 'set!' them (destructive assignment of existent variables)<br/>
			&nbsp;&nbsp;&nbsp;and you must start your programs with a 'begin' to execute more than one thing<br/>
			As an example, in the 'env' input text write <br/>
			'a:3, b:[1,2,3]'<br/>
			and in 'code' textarea write<br/><br/>
			<textarea class="exampleCode" readonly="readonly">(if (= a 2)        ;;if a == 2
  (begin           ;;  then
	(set! a 99)    ;;    assign 99 to a
	(cons a b)     ;;    make a list starting with a, ending with b
  )
  (begin           ;;  else
	 (define x 99) ;;    create a variable x = 99
	 (+            ;;    sum
	  (car b)      ;;       first element of b
	   x           ;;       to x
	 )
  )
)</textarea><br/><br/>
			press F9 and see what happens!<br/>
			See more examples clicking the "Examples" menu!!<br/>
			<a href="#" class="jqmClose">Close</a>
		</div>
		<div id="examples" class="jqmWindow">
			<h3>Examples</h3>
			<div class="showExamplesScroll">
				<h4>Factorial</h4>
				<textarea class="exampleCode" readonly="readonly">;;Factorial:
(begin (define fact (lambda (n) (
  if (= 0 n) 1 
   (*
      n 
     (fact 
	(-  
	   n 
           1))))))
				
  (log (fact 0))
  (log (fact 1))
  (log (fact 4))
  (log 'finished)
)</textarea><br/>
				<h4>Fibonacci</h4>
				<textarea class="exampleCode" readonly="readonly">;;Fibonacci:
(begin 
  (define 
    fib 
    (lambda (n)
      (if (< n 2) 
         n 
        (+ 
          (fib (- n 1)) 
          (fib (- n 2))
        )
      )    
    )			
  ) 
  (log (fib 0))
  (log (fib 1))
  (log (fib 2))
  (log (fib 3))
  (log (fib 8))
  (log 'finished)
)</textarea><br/>
	<h4>Reverse</h4>
				<textarea class="exampleCode" readonly="readonly">;;Reverse:
(begin
  (define 
    reverse 
     (lambda 
      (x)
      (if (isEmpty? x) 
        '()
	 (append
          (reverse (cdr x)) 
          (cons (car x) '())
         )
       )
     )
   )

  (log (reverse '(1 2 3)))
  (log (reverse '(1)))
  (log	(reverse '()))
  (log	'finished)
)</textarea><br/>
<h4>isPresent?</h4>
				<textarea class="exampleCode" readonly="readonly">;;isPresent?:
(begin
  (define 
    isPresent?
     (lambda 
      (x list)
      (if (isEmpty? list) 
        '#f
	 (if (= x (car list))
           '#t
           (isPresent? x (cdr list))
         )        
       )
     )
   )

  (log (isPresent? 3 '()))
  (log (isPresent? 2 '(1 2 3)))
  (log (isPresent? 4 '(1 2 3)))
  (log 'finished)
)</textarea><br/>
<h4>apply</h4>
				<textarea class="exampleCode" readonly="readonly">;;apply
(begin
  (define 
    apply
     (lambda 
      (f list)
      (if (isEmpty? list) 
        '()
        (cons (f (car list)) (apply f (cdr list)))
       )
     )
   )
  (define 
    plusOne
    (lambda 
      (n)
      (+ n 1)
    )
  )
  (log (apply plusOne '()))
  (log (apply plusOne '(1 2 3)))
  (log 'finished)
)</textarea><br/>
<h4>flatten</h4>
				<textarea class="exampleCode" readonly="readonly">;;flatten
(begin
  (define 
    flatten
     (lambda 
      (list)
      (if (isEmpty? list) 
        '()
        (if (isList? (car list))
          (append 
            (flatten (car list)) 
            (flatten (cdr list))
          )
          (cons 
            (car list) 
            (flatten (cdr list))
          )
        )        
      )
    )
  )

  (log (flatten '()))
  (log (flatten '(1 2 3)))
  (log (flatten '((101 102 103) 2 3)))
  (log (flatten '((1 2 3) 4 (5 6 (7 8 (9 10))))))
  (log 'finished)
)</textarea><br/><br/>
			</div>			
			<a href="#" class="jqmClose">Close</a>
			
		</div>				
		<thead>
			<tr>
				<th>code <span class="spanenv"> env = {<input type = "text" id = "env"></input> }  (write something like a : 30, b : 60, c :[1 ,2 , 3 ])</span></th>
				<th>log</th>				
			</tr>
		</thead>

		<tbody>
			<tr class="rowbig">
				<td id="cellcode"><textarea id="code" cols="3" rows="3"></textarea></td>
				<td><textarea readonly="readonly" id="log" cols="3" rows="3"></textarea></td>				
			</tr>
			<tr class="rowsmall">
				<td><input type="button" id="focus" value="Focus F8"
					onclick="$('#code').focus()" /> <input type="button" id="runCode"
					value="Run code F9" /> <input type="button" id="clearCode"
					value="Clear code Alt-Ctrl-C" onclick="$('#code').val('')" /></td>
				<td><input type="button" id="clearLog"
					value="Clear log Alt-Ctrl-L" onclick="$('#log').val('')" /></td>					
			</tr>
		</tbody>
	</table>

	<script>
		function toStr(msg) {
			if(typeof msg === 'undefined'){
				return '<undefined>';
			}else if (msg == null){
				return '<null>';
			}
			return msg.toString();
		}

		function log(msg) {
			var textAreaLog = $('#log');
			var strMsg = toStr(msg);
			textAreaLog.val(textAreaLog.val() + strMsg.toString() + '\n');
			textAreaLog = textAreaLog[0]; // the real element, not the jQuery wrapper
			textAreaLog.scrollTop = textAreaLog.scrollHeight;
		};
		function logJSON(obj) {
			log($.toJSON(obj));
		};
		function evalScheemString(code, env){
			var ast = SCHEEM.parse(code);
			return evalScheem(ast, env);
		}		
		$(document).ready(function(){
					$('#runCode').click(function(event) {
						var envOk = true;
						var env = $('#env').val();
						try{
							env = eval("({" + env + "})");
							env = Interpreter.createBasicEnv(env);
						}catch (error) {
							log("Error parsing env: " + error);
							envOk = false;
						}
						if(envOk){
						var code = $('#code').val();
							try {
								log(Interpreter.evalScheemString(code, env));
							} catch (error) {
								log("Error parsing code:" + error);
							}
						}
					});
					$('body').keyup(
							function(event) {
								if (event.altKey && event.ctrlKey) {
									if (event.which == 76) { //L
										$('#clearLog').click();
									} else if (event.which == 67) {//C
										$('#clearCode').click();
									} 
								} else if (!event.altKey && !event.ctrlKey){
									if(event.which == 119) {//F8
										$('#focus').click();
									}
									else if(event.which == 120) {//F9
										$('#runCode').click();
									}
								}
							});
					$('#code').focus(function() {
						$(this).css('background-color', '#e0f0e0');
					}).blur(function() {
						$(this).css('background-color', 'white');
					}).focus();
					$('#env').focus(function() {
						$(this).css('background-color', '#e0f0e0');
					}).blur(function() {
						$(this).css('background-color', 'white');
					});		
					$('#help').jqm({modal: true, trigger: '#showHelp'})
					$('#examples').jqm({modal: true, trigger: '#showExamples'})
				});
	</script>
</body>
</html>